<meta name=viewport content="width=device-width,initial-scale=1"><html><head><title>state manager</title><style type=text/css>#stateVal{float:left;width:200px;margin-top:0;margin-left:20px}#buttons{float:left}.cnt{margin:0 auto;max-width:420px}body{background:#eee;color:#333;font-family:monospace}body.night{background:#333;color:#eee}input[type=button]{border:none;padding:5px 10px;border-radius:3px;display:block;width:100%;border:1px solid #777}.active{position:relative;-webkit-animation:spin .24s linear infinite;-moz-animation:spin .24s linear infinite;animation:spin .24s linear infinite}@-moz-keyframes spin{0%{-moz-transform:rotate(-2deg)}25%{-moz-transform:rotate(0)}50%{-moz-transform:rotate(2deg)}75%{-moz-transform:rotate(0)}100%{-moz-transform:rotate(-2deg)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(-2deg)}25%{-webkit-transform:rotate(0)}50%{-webkit-transform:rotate(2deg)}75%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(-2deg)}}@keyframes spin{0%{transform:rotate(-2deg)}25%{transform:rotate(0)}50%{transform:rotate(2deg)}75%{transform:rotate(0)}100%{transform:rotate(-2deg)}}</style><body><div class=cnt><h1>State Manager</h1><hr><br><div id=buttons><input type=button id=start5 value="Start 5 sec idel state listener"><br><br><input type=button id=start7 value="Start 7 sec idel state listener"><br><br><input type=button id=stop5 value="Stop 5 sec idel state listener"><br><br><input type=button id=stop7 value="Stop 7 sec idel state listener"><br><br><input type=button id=stopAll value="Stop all listener"><br><br><input type=button id=cleareLog value="Cleare logs"><br><br></div><p id=stateVal><strong>Logs:</strong></p></div><script>function UserStateManager(){var e=null,i=function(){return(new Date).getTime()};this.addListener=function(i,t){var n="state_ts_"+i,r=this;return e||(this.eventManager(),e=[]),e[n]||isNaN(i)?(console.warn("Can't add "+n+" as it is already exist (or) invalid input."),!1):(e[n]={},e[n].duration=i,this.setTimers(i,t),{removeListener:this.removeListener.bind(this,i),reInitiate:function(){r.removeListener.bind(r,i),r.addListener.bind(r,i,t)}})},this.setTimers=function(t,n){var r="state_ts_"+t,s=this;e[r].timer=setTimeout(function(){n(),s.removeListener(e[r].duration)},t),e[r].endTs=t+i(),e[r].cb=n},this.removeListener=function(i){var t="state_ts_"+i;e[t]?(clearTimeout(e[t].timer),delete e[t]):console.warn("state for duration - "+i+" is not avialble to remove")},this.removeAllListeners=function(){for(var i in e)clearTimeout(e[i].timer);e=null},this.eventManager=function(){var e=this;window.onmousemove=function(i){return e.xy==i.clientX+"x"+i.clientY?!0:(e.xy=i.clientX+"x"+i.clientY,void e.resetTimerForActiveUser.call(e))},window.onmousedown=this.resetTimerForActiveUser(this),window.onclick=this.resetTimerForActiveUser.bind(this),window.onscroll=this.resetTimerForActiveUser.bind(this),window.onkeypress=this.resetTimerForActiveUser.bind(this),window.onfocus=this.resetTimeoutONFocus.bind(this),window.onpageshow=this.resetTimeoutONFocus.bind(this),visibleChangeListener.addVisibleChangeListener(this.resetTimeoutONFocus.bind(this))},this.resetTimeoutONFocus=function(){for(var t in e)e[t]&&(e[t].endTs>=i()?(clearTimeout(e[t].timer),this.setTimers(e[t].duration,e[t].cb)):(self.removeListener(e[t].duration),e[t].cb()))},this.resetTimerForActiveUser=function(){for(var t in e)if(e[t]){var n=e[t].duration,r=e[t].cb;e[t].endTs>=i()?(clearTimeout(e[t].timer),this.setTimers(n,r)):(self.removeListener(n),r())}}}var visibleChangeListener=function(){var e,i,t,n={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(e in n)if(e in document){i=n[e];break}var r=function(e){return e&&document.addEventListener(i,e),!document[i]},s=function(){t&&document.removeEventListener(i,t)};return{addVisibleChangeListener:r,removeVisibleChangeListener:s}}(),stateManager,GetState=function(){return stateManager||(stateManager=new UserStateManager),stateManager};"undefined"!=typeof module&&(module.exports={GetState:GetState});</script><script>!function(e){var t,i=GetState(),n=document.getElementById("start5"),r=document.getElementById("start7"),s=document.getElementById("stateVal");n.onclick=function(){t=i.addListener(5e3,function(){s.innerHTML+="<br/>inactive more then 5 sec",n.removeAttribute("class")}),s.innerHTML+="<br/>5 sec listener starts",n.setAttribute("class","active")},r.onclick=function(){i.addListener(7e3,function(){s.innerHTML+="<br/>inactive more then 7 sec",r.removeAttribute("class")}),s.innerHTML+="<br/>7 sec listener starts",r.setAttribute("class","active")},document.getElementById("stop5").onclick=function(){t.removeListener(),n.removeAttribute("class"),s.innerHTML+="<br/>5sec listener removed"},document.getElementById("stop7").onclick=function(){r.removeAttribute("class"),i.removeListener(7e3),s.innerHTML+="<br/>7sec listener removed"},document.getElementById("stopAll").onclick=function(){i.removeAllListeners(),s.innerHTML+="<br/>All listener removed",n.removeAttribute("class"),r.removeAttribute("class")},document.getElementById("cleareLog").onclick=function(){s.innerHTML="<strong>Logs:</strong>"}}();var t=new Date();(t.getHours()<6||t.getHours()>18)&&document.body.setAttribute("class","night");</script>
