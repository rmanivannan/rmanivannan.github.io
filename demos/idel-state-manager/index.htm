<html><head><title>state manager</title><style type=text/css>#stateVal{float:right;width:250px;margin-top:0;margin-left:20px}#buttons{float:left}.cnt{width:500px;margin:0 auto}body{background:#eee;color:#333;font-family:monospace}body.night{background:#333;color:#eee}input[type=button]{border:none;padding:5px 10px;border-radius:3px;display:block;width:100%;border:1px solid #777}.active{position:relative;-webkit-animation:spin .24s linear infinite;-moz-animation:spin .24s linear infinite;animation:spin .24s linear infinite}@-moz-keyframes spin{0%{-moz-transform:rotate(-2deg)}25%{-moz-transform:rotate(0)}50%{-moz-transform:rotate(2deg)}75%{-moz-transform:rotate(0)}100%{-moz-transform:rotate(-2deg)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(-2deg)}25%{-webkit-transform:rotate(0)}50%{-webkit-transform:rotate(2deg)}75%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(-2deg)}}@keyframes spin{0%{transform:rotate(-2deg)}25%{transform:rotate(0)}50%{transform:rotate(2deg)}75%{transform:rotate(0)}100%{transform:rotate(-2deg)}}</style><body><div class=cnt><h1>State Manager</h1><hr><br><div id=buttons><input type=button id=start5 value="Start 5 sec idel state listener"><br><br><input type=button id=start7 value="Start 7 sec idel state listener"><br><br><input type=button id=stop5 value="Stop 5 sec idel state listener"><br><br><input type=button id=stop7 value="Stop 7 sec idel state listener"><br><br><input type=button id=stopAll value="Stop all listener"><br><br><input type=button id=cleareLog value="Cleare logs"><br><br></div><p id=stateVal><strong>Logs:</strong></p></div><script>function UserStateManager(){var e=null;this.addListener=function(t,i){var n="state_ts_"+t;return e||(this.eventManager(),e=[]),e[n]||isNaN(t)?(console.warn("Can't add "+n+" as it is already exist (or) invalid input."),!1):(e[n]={},e[n].duration=t,this.setTimers(t,i),void 0)},this.setTimers=function(t,i){var n="state_ts_"+t,r=this;e[n].timer=setTimeout(function(){i(),r.removeListener(e[n].duration)},t),e[n].endTs=t+(new Date).getTime(),e[n].cb=i},this.removeListener=function(t){var i="state_ts_"+t;e[i]?(clearTimeout(e[i].timer),delete e[i]):console.warn("state for duration - "+t+" is not avialble to remove")},this.removeAllListeners=function(){for(var t in e)clearTimeout(e[t].timer);e=null},this.eventManager=function(){var e=this;window.onmousemove=function(t){return e.xy==t.clientX+"x"+t.clientY?!0:(e.xy=t.clientX+"x"+t.clientY,void e.resetTimerForActiveUser.call(e))},window.onmousedown=this.resetTimerForActiveUser(this),window.onclick=this.resetTimerForActiveUser.bind(this),window.onscroll=this.resetTimerForActiveUser.bind(this),window.onkeypress=this.resetTimerForActiveUser.bind(this),window.onfocus=this.resetTimeoutONFocus.bind(this),window.onpageshow=this.resetTimeoutONFocus.bind(this),visibleChangeListener.addVisibleChangeListener(function(){e.resetTimeoutONFocus()})},this.resetTimeoutONFocus=function(){for(var t in e)e[t]&&(e[t].endTs>=(new Date).getTime()?(clearTimeout(e[t].timer),this.setTimers(e[t].duration,e[t].cb)):(self.removeListener(e[t].duration),e[t].cb()))},this.resetTimerForActiveUser=function(t){for(var i in e)if(e[i]){var n=e[i].duration,r=e[i].cb;e[i].endTs>=(new Date).getTime()?(clearTimeout(e[i].timer),this.setTimers(n,r)):(self.removeListener(n),r())}}}var visibleChangeListener=function(){var e,t,i,n={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(e in n)if(e in document){t=n[e];break}var r=function(e){return e&&document.addEventListener(t,e),!document[t]},s=function(){i&&document.removeEventListener(t,i)};return{addVisibleChangeListener:r,removeVisibleChangeListener:s}}(),stateManager,GetState=function(){return stateManager||(stateManager=new UserStateManager),stateManager};module&&(module.exports={GetState:GetState});</script><script>!function(e){var t=GetState(),n=document.getElementById("start5"),i=document.getElementById("start7"),r=document.getElementById("stateVal");n.onclick=function(){t.addListener(5e3,function(){r.innerHTML+="<br/>inactive more then 5 sec",n.removeAttribute("class")}),r.innerHTML+="<br/>5 sec listener starts",n.setAttribute("class","active")},i.onclick=function(){t.addListener(7e3,function(){r.innerHTML+="<br/>inactive more then 7 sec",i.removeAttribute("class")}),r.innerHTML+="<br/>7 sec listener starts",i.setAttribute("class","active")},document.getElementById("stop5").onclick=function(){t.removeListener(5e3),n.removeAttribute("class"),r.innerHTML+="<br/>5sec listener removed"},document.getElementById("stop7").onclick=function(){i.removeAttribute("class"),t.removeListener(7e3),r.innerHTML+="<br/>7sec listener removed"},document.getElementById("stopAll").onclick=function(){t.removeAllListeners(),r.innerHTML+="<br/>All listener removed",n.removeAttribute("class"),i.removeAttribute("class")},document.getElementById("cleareLog").onclick=function(){r.innerHTML="<strong>Logs:</strong>"}}();var t=new Date;(t.getHours()<6||t.getHours()>18)&&document.body.setAttribute("class","night");</script>
